generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Event {
  id                String               @id @default(cuid())
  title             String
  eventType         String
  location          String
  latitude          Float?
  longitude         Float?
  startDate         DateTime
  endDate           DateTime?
  cost              Float?
  description       String?
  isRecurring       Boolean              @default(false)
  imageUrl          String?
  minTeams          Int?
  maxTeams          Int?
  acceptedTeamTypes String[]             @default([])
  visibility        TournamentVisibility @default(PUBLIC)
  createdAt         DateTime             @default(now())
  updatedAt         DateTime             @updatedAt
  clubId            String?
  club              Club?                @relation(fields: [clubId], references: [id])
  interests         Interest[]
  matches           Match[]
  surveyResponses   SurveyResponse[]
  teams             TournamentTeam[]

  @@index([startDate])
  @@index([eventType])
  @@index([location])
  @@index([clubId])
  @@index([startDate, eventType])
  @@index([latitude, longitude])
  @@index([acceptedTeamTypes])
  @@index([visibility])
}

model Interest {
  id          String   @id @default(cuid())
  eventId     String
  name        String
  email       String
  message     String?
  submittedAt DateTime @default(now())
  event       Event    @relation(fields: [eventId], references: [id])

  @@index([eventId])
  @@index([submittedAt])
}

model Club {
  id                  String               @id @default(cuid())
  name                String
  region              String?
  subRegion           String?
  map                 String?
  facebook            String?
  instagram           String?
  website             String?
  codes               String?
  imageUrl            String?
  location            String?
  latitude            Float?
  longitude           Float?
  teamTypes           String[]             @default([])
  contactFirstName    String?
  contactLastName     String?
  contactEmail        String?
  contactPhone        String?
  contactCountryCode  String?
  isContactWilling    Boolean              @default(false)
  status              ClubStatus           @default(PENDING)
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @default(now()) @updatedAt
  submittedBy         String?
  reviewedAt          DateTime?
  reviewedBy          String?
  rejectionReason     String?
  adminNotes          String?
  availabilitySlots   AvailabilitySlot[]
  bookings            Booking[]
  clubAdminRequests   ClubAdminRequest[]
  clubInterests       ClubInterest[]
  events              Event[]
  hostingPackages     HostingPackage[]
  tournamentInterests TournamentInterest[]
  tournamentTeams     TournamentTeam[]
  members             User[]               @relation("ClubMembers")
  admins              User[]               @relation("ClubAdmins")

  @@index([status])
  @@index([location])
  @@index([teamTypes])
  @@index([name])
  @@index([latitude, longitude])
  @@index([region, subRegion])
  @@index([createdAt])
  @@index([submittedBy])
}

model User {
  id                    String               @id @default(cuid())
  email                 String               @unique
  username              String               @unique
  password              String
  name                  String?
  role                  UserRole             @default(USER)
  accountStatus         AccountStatus        @default(PENDING)
  clubId                String?
  createdAt             DateTime             @default(now())
  updatedAt             DateTime             @updatedAt
  approvedAt            DateTime?
  approvedBy            String?
  rejectionReason       String?
  accounts              Account[]
  reviewedAdminRequests ClubAdminRequest[]   @relation("AdminRequestReviewer")
  clubAdminRequests     ClubAdminRequest[]
  passwordResetTokens   PasswordResetToken[]
  sessions              Session[]
  tournamentInterests   TournamentInterest[]
  club                  Club?                @relation("ClubMembers", fields: [clubId], references: [id])
  preferences           UserPreferences?
  adminOfClubs          Club[]               @relation("ClubAdmins")

  @@index([accountStatus])
  @@index([role])
  @@index([clubId])
  @@index([createdAt])
  @@index([email])
}

model Account {
  id                       String  @id @default(cuid())
  userId                   String
  type                     String
  provider                 String
  providerAccountId        String
  refresh_token            String?
  access_token             String?
  expires_at               Int?
  token_type               String?
  scope                    String?
  id_token                 String?
  session_state            String?
  refresh_token_expires_in Int?
  user                     User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model SurveyResponse {
  id                    String   @id @default(cuid())
  eventId               String?
  role                  String
  clubName              String?
  country               String
  city                  String?
  hasTraveledAbroad     String
  travelFrequency       String?
  destinationsVisited   String[] @default([])
  preferredTravelTime   String
  teamSize              String
  budgetPerPerson       String
  biggestChallenge      String
  interestedServices    String[] @default([])
  wouldHost             String
  wouldPayForPlatform   String
  improvementSuggestion String?
  additionalFeedback    String?
  contactName           String
  contactEmail          String
  contactPhone          String?
  submittedAt           DateTime @default(now())
  ipAddress             String?
  userAgent             String?
  referrer              String?
  event                 Event?   @relation(fields: [eventId], references: [id])
}

model ClubInterest {
  id          String   @id @default(cuid())
  clubId      String
  name        String
  email       String
  message     String?
  type        String
  submittedAt DateTime @default(now())
  club        Club     @relation(fields: [clubId], references: [id])
}

model ClubAdminRequest {
  id              String                 @id @default(cuid())
  userId          String
  clubId          String
  reason          String
  status          ClubAdminRequestStatus @default(PENDING)
  requestedAt     DateTime               @default(now())
  reviewedAt      DateTime?
  reviewedBy      String?
  rejectionReason String?
  club            Club                   @relation(fields: [clubId], references: [id])
  reviewer        User?                  @relation("AdminRequestReviewer", fields: [reviewedBy], references: [id])
  user            User                   @relation(fields: [userId], references: [id])

  @@unique([userId, clubId])
  @@index([status])
  @@index([clubId])
  @@index([requestedAt])
}

model HostingPackage {
  id              String    @id @default(cuid())
  clubId          String
  name            String
  description     String?
  basePrice       Float
  dayPassPrice    Float?
  maxTeams        Int       @default(1)
  maxParticipants Int?
  services        String[]  @default([])
  isActive        Boolean   @default(true)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  bookings        Booking[]
  club            Club      @relation(fields: [clubId], references: [id])
}

model Booking {
  id            String          @id @default(cuid())
  clubId        String
  packageId     String?
  contactName   String
  contactEmail  String
  contactPhone  String?
  teamName      String
  teamSize      Int
  arrivalDate   DateTime
  departureDate DateTime
  totalAmount   Float
  platformFee   Float
  clubEarnings  Float
  status        BookingStatus   @default(INQUIRY)
  notes         String?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  club          Club            @relation(fields: [clubId], references: [id])
  package       HostingPackage? @relation(fields: [packageId], references: [id])
  payments      Payment[]
}

model Payment {
  id              String        @id @default(cuid())
  bookingId       String
  amount          Float
  type            PaymentType
  status          PaymentStatus @default(PENDING)
  stripePaymentId String?
  processedAt     DateTime?
  createdAt       DateTime      @default(now())
  booking         Booking       @relation(fields: [bookingId], references: [id])
}

model TournamentTeam {
  id           String     @id @default(cuid())
  eventId      String
  clubId       String
  teamName     String
  teamType     String
  registeredAt DateTime   @default(now())
  status       TeamStatus @default(REGISTERED)
  awayMatches  Match[]    @relation("AwayTeam")
  homeMatches  Match[]    @relation("HomeTeam")
  club         Club       @relation(fields: [clubId], references: [id])
  event        Event      @relation(fields: [eventId], references: [id])

  @@unique([eventId, clubId, teamName])
}

model Match {
  id         String         @id @default(cuid())
  eventId    String
  homeTeamId String
  awayTeamId String
  matchDate  DateTime?
  venue      String?
  round      String?
  homeScore  Int?
  awayScore  Int?
  status     MatchStatus    @default(SCHEDULED)
  createdAt  DateTime       @default(now())
  updatedAt  DateTime       @updatedAt
  awayTeam   TournamentTeam @relation("AwayTeam", fields: [awayTeamId], references: [id])
  event      Event          @relation(fields: [eventId], references: [id])
  homeTeam   TournamentTeam @relation("HomeTeam", fields: [homeTeamId], references: [id])
}

model AvailabilitySlot {
  id          String   @id @default(cuid())
  clubId      String
  date        DateTime
  isRecurring Boolean  @default(false)
  dayOfWeek   Int?
  timeSlots   String[]
  capacity    Int?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  club        Club     @relation(fields: [clubId], references: [id])

  @@index([clubId, date])
  @@index([date])
}

model TournamentInterest {
  id             String           @id @default(cuid())
  userId         String
  clubId         String
  interestType   InterestType
  specificDate   DateTime?
  monthYear      DateTime?
  dateRangeStart DateTime?
  dateRangeEnd   DateTime?
  teamSize       Int
  flexibility    FlexibilityLevel @default(FLEXIBLE)
  message        String?
  status         InterestStatus   @default(PENDING)
  suggestedDates DateTime[]
  clubResponse   String?
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  club           Club             @relation(fields: [clubId], references: [id])
  user           User             @relation(fields: [userId], references: [id])

  @@index([clubId, status])
  @@index([userId])
  @@index([monthYear])
  @@index([status])
}

model PasswordResetToken {
  id        String   @id @default(cuid())
  token     String   @unique
  userId    String
  expiresAt DateTime
  createdAt DateTime @default(now())
  used      Boolean  @default(false)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([token])
  @@index([userId])
  @@index([expiresAt])
}

model UserPreferences {
  id                  String   @id @default(cuid())
  userId              String   @unique
  motivations         String[]
  competitiveLevel    String?
  preferredCities     String[]
  preferredCountries  String[]
  preferredClubs      String[]
  activities          String[]
  budgetRange         String?
  maxFlightTime       Int?
  preferredMonths     String[]
  onboardingCompleted Boolean  @default(false)
  onboardingSkipped   Boolean  @default(false)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  user                User     @relation(fields: [userId], references: [id])

  @@index([userId])
}

enum UserRole {
  SUPER_ADMIN
  CLUB_ADMIN
  GUEST_ADMIN
  USER
}

enum AccountStatus {
  PENDING
  APPROVED
  REJECTED
  SUSPENDED
}

enum ClubStatus {
  PENDING
  APPROVED
  REJECTED
}

enum TournamentVisibility {
  PUBLIC
  PRIVATE
}

enum ClubAdminRequestStatus {
  PENDING
  APPROVED
  REJECTED
}

enum BookingStatus {
  INQUIRY
  QUOTE_SENT
  CONFIRMED
  DEPOSIT_PAID
  FULL_PAID
  COMPLETED
  CANCELLED
}

enum PaymentType {
  DEPOSIT
  FULL_PAYMENT
  REFUND
}

enum PaymentStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  REFUNDED
}

enum TeamStatus {
  REGISTERED
  CONFIRMED
  WITHDRAWN
}

enum MatchStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  POSTPONED
}

enum InterestType {
  SPECIFIC_DATE
  ENTIRE_MONTH
  DATE_RANGE
  MULTIPLE_MONTHS
}

enum FlexibilityLevel {
  FIXED
  FLEXIBLE
  VERY_FLEXIBLE
}

enum InterestStatus {
  PENDING
  IN_DISCUSSION
  APPROVED
  REJECTED
  CANCELLED
}
